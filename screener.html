<script>
  // Tab switching
  function showTab(tabId) {
    document.querySelectorAll('.screener-tab').forEach(tab => {
      tab.style.display = 'none';
    });
    document.getElementById(tabId).style.display = 'block';

    // Optional: highlight active button (advanced UX, can add if needed)
  }

  // Event Listeners
  document.getElementById('run-custom').addEventListener('click', runScreener);
  document.getElementById('run-prebuilt').addEventListener('click', runPrebuilt);
  // Optional: If you later add "Run AI Screener" button → add listener here

  // Run Custom Screener (Symbol, Greeks, OI, IV)
  function runScreener() {
    const symbolFilter = document.getElementById('symbol').value;
    const deltaMin = parseFloat(document.getElementById('greeks-delta').value);
    const oiMin = parseFloat(document.getElementById('oi-change').value);
    const ivMax = parseFloat(document.getElementById('iv').value);

    const data = getDummyData();

    const filtered = data.filter(stock => {
      if (symbolFilter && stock.symbol !== symbolFilter) return false;
      if (!isNaN(deltaMin) && Math.abs(stock.delta) < deltaMin) return false;
      if (!isNaN(oiMin) && stock.oiChange < oiMin) return false;
      if (!isNaN(ivMax) && stock.iv > ivMax) return false;

      return true;
    });

    renderResults(filtered);
  }

  // Run Pre-Built Screener (Open = High / Low only)
  function runPrebuilt() {
    const openFilter = document.getElementById('open-filter').value;
    const data = getDummyData();

    const filtered = data.filter(stock => {
      if (openFilter === 'open-high' && Math.abs(stock.open - stock.high) >= 0.01) return false;
      if (openFilter === 'open-low' && Math.abs(stock.open - stock.low) >= 0.01) return false;
      return true;
    });

    renderResults(filtered);
  }

  // Optional Future → Run AI Screener (DeltaGPT integration placeholder)
  /*
  function runAIScreener() {
    // Example: Call DeltaGPT API → receive suggestions → renderResults(suggestions);
    console.log('Run AI Screener triggered (coming soon)');
  }
  */

  // Render Results Table
  function renderResults(results) {
    const tbody = document.getElementById('results-body');
    tbody.innerHTML = '';

    if (results.length === 0) {
      tbody.innerHTML = '<tr><td colspan="9">No matching results.</td></tr>';
      return;
    }

    results.forEach(stock => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${stock.symbol}</td>
        <td>${stock.strike}</td>
        <td>${stock.type}</td>
        <td>${stock.delta}</td>
        <td>${stock.oiChange}%</td>
        <td>${stock.iv}%</td>
        <td>${stock.open}</td>
        <td>${stock.high}</td>
        <td>${stock.low}</td>
      `;
      tbody.appendChild(row);
    });
  }

  // Dummy Data for Testing (Replace later with API)
  function getDummyData() {
    return [
      { symbol: 'NIFTY', strike: 22500, type: 'Call', delta: 0.35, oiChange: 12, iv: 22, open: 22500, high: 22500, low: 22000 },
      { symbol: 'BANKNIFTY', strike: 48500, type: 'Put', delta: -0.42, oiChange: 8, iv: 27, open: 48500, high: 48700, low: 48500 },
      { symbol: 'RELIANCE', strike: 2600, type: 'Call', delta: 0.5, oiChange: 10, iv: 30, open: 2600, high: 2650, low: 2600 },
      { symbol: 'INFY', strike: 1500, type: 'Put', delta: -0.3, oiChange: 6, iv: 25, open: 1500, high: 1500, low: 1490 },
    ];
  }
</script>
